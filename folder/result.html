<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ³•å®šç ”ä¿®å®Ÿæ–½ãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆ</title>
    
    <style>
        /* Strict Design System */
        :root {
            --primary: #ff9900;       
            --primary-hover: #e68a00; 
            --text-main: #0f172a;     
            --text-muted: #64748b;    
            --surface: #ffffff;
            --background: #f8fafc;    
            --border: #e2e8f0;        
            --danger: #ef4444;        
            --info-bg: #fff7ed;       
            --info-text: #c2410c;     
            --radius-md: 0.5rem;
            --radius-lg: 1rem;
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            
            /* Facebook/Meta-like Friendly UI Colors */
            --meta-bg: #f0f2f5;
            --meta-icon-bg: #e4e6eb;
            --meta-text: #050505;
            --meta-sub: #65676b;
            --meta-blue: #1877f2;
        }

        *, *::before, *::after { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", sans-serif;
            background-color: var(--background);
            color: var(--text-main);
            line-height: 1.6;
            margin: 0;
            padding: 1rem;
            font-size: 16px; 
        }

        .container { max-width: 800px; margin: 0 auto; }

        .card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        h1 { color: var(--text-main); font-weight: 700; margin-top: 0; letter-spacing: -0.025em; }
        .text-center { text-align: center; }
        .text-muted { color: var(--text-muted); font-size: 0.9rem; }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 2px solid var(--text-main);
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
            gap: 1rem;
            flex-wrap: wrap; 
        }

        .header-left-info { flex: 1; min-width: 200px; }
        .info-row { margin-bottom: 0.5rem; display: flex; align-items: baseline; }
        .info-label { width: 100px; color: var(--text-muted); font-size: 0.9rem; font-weight: 500; }
        .info-value { font-weight: 700; font-size: 1.1rem; }

        .header-right-ad {
            width: 200px;
            background-color: #fff1f2; 
            border: 2px solid var(--danger);
            padding: 0.75rem;
            text-align: center;
            border-radius: var(--radius-md);
            flex-shrink: 0;
            margin: 0 auto; 
        }

        .ad-title { font-size: 0.7rem; color: var(--danger); font-weight: 800; margin-bottom: 0.5rem; line-height: 1.3; }
        .qr-placeholder {
            width: 80px; height: 80px;
            background-color: white;
            margin: 0 auto 0.5rem auto;
            display: flex; align-items: center; justify-content: center;
        }
        .ad-sub { font-size: 0.65rem; font-weight: 700; color: var(--text-main); }

        .intro-message {
            background: var(--background);
            padding: 0.75rem 1rem;
            border-left: 4px solid var(--text-main);
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }

        .checklist-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            border: 2px solid var(--text-main);
        }
        .checklist-table th, .checklist-table td {
            border: 1px solid var(--text-main);
            padding: 0.75rem;
            text-align: left;
            font-size: 0.9rem;
            vertical-align: middle;
        }
        .checklist-table th { background-color: #f1f5f9; font-weight: 700; text-align: center; }
        .checklist-table .check-col { width: 60px; text-align: center; }
        
        .checkbox-square {
            display: inline-block;
            width: 18px; height: 18px;
            border: 2px solid var(--text-main);
            background: white;
            border-radius: 2px;
        }

        button.secondary-btn {
            background-color: var(--text-muted);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            margin-top: 1rem;
            width: auto;
            display: inline-block;
        }

        /* IAB (In-App Browser) Guide UI */
        .iab-guide-container {
            background-color: var(--meta-bg);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            max-width: 360px;
            margin: 0 auto;
            border: 1px solid var(--border);
            animation: fadeIn 0.5s ease-out;
        }
        .iab-icon-circle {
            width: 48px; height: 48px;
            background-color: var(--meta-icon-bg);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 1rem auto;
            font-size: 1.5rem;
        }
        .iab-title {
            color: var(--meta-text);
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        .iab-desc {
            color: var(--meta-sub);
            font-size: 0.9rem;
            margin-bottom: 1.25rem;
            line-height: 1.5;
        }
        .iab-step {
            background-color: white;
            padding: 0.75rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--meta-blue);
            box-shadow: var(--shadow-md);
            display: inline-block;
            margin-bottom: 0.5rem;
        }
        .iab-sub-note {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            line-height: 1.4;
        }

        @media print {
            body { background: white; padding: 0; margin: 0; }
            .container { max-width: 100%; }
            .card { box-shadow: none !important; border: none !important; padding: 0 !important; margin: 0 !important; }
            .action-area { display: none !important; }
            @page { margin: 15mm; }
        }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="container fade-in">
        <div id="printable-area" class="card">
            <h1 id="pdf-title" class="text-center" style="font-size: 1.5rem; border-bottom: 2px solid var(--text-main); padding-bottom: 1rem; margin-bottom: 1.5rem;">æ³•å®šç ”ä¿®å®Ÿæ–½ãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆ</h1>
            
            <div class="header-container">
                <div class="header-left-info">
                    <div class="info-row"><span class="info-label">æ–½è¨­å</span> <span class="info-value" id="out-facility">èª­è¾¼ä¸­...</span></div>
                    <div class="info-row"><span class="info-label">ä»£è¡¨è€…</span> <span class="info-value" id="out-rep">èª­è¾¼ä¸­...</span></div>
                    <div class="info-row"><span class="info-label">äº‹æ¥­å½¢æ…‹</span> <span class="info-value" id="out-type">èª­è¾¼ä¸­...</span></div>
                    <div class="info-row"><span class="info-label">ä½œæˆæ—¥</span> <span class="info-value" id="out-date">èª­è¾¼ä¸­...</span></div>
                </div>
                
                <div class="header-right-ad">
                    <div class="ad-title">â–¼ ç ”ä¿®ãƒ»åŠ ç®—ã®ç„¡æ–™ç›¸è«‡ â–¼</div>
                    <div class="qr-placeholder">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://example.com" alt="QR" style="width:100%; height:100%;">
                    </div>
                    <div class="ad-sub">ã‚¹ãƒãƒ›ã§ãŠå•ã„åˆã‚ã›</div>
                </div>
            </div>

            <p class="intro-message">è²´äº‹æ¥­æ‰€ãŒå®Ÿæ–½ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„æ³•å®šç ”ä¿®ä¸€è¦§</p>
            <p class="text-muted" style="font-size: 0.8rem; margin-bottom: 1rem;">
                â€»å›½ãŒå®šã‚ã‚‹æ³•å®šç ”ä¿®ã§ã™ã€‚æŒ‡å®šæ¨©è€…ï¼ˆè‡ªæ²»ä½“ï¼‰ã«ã‚ˆã‚Šè¿½åŠ ç ”ä¿®ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å¿…ãšæ¡ä¾‹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
            </p>

            <table class="checklist-table">
                <thead>
                    <tr>
                        <th>ç ”ä¿®ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…å®¹</th>
                        <th style="width: 100px;">å®Ÿæ–½æ—¥</th>
                        <th class="check-col">ç¢ºèª</th>
                    </tr>
                </thead>
                <tbody id="checklist-body">
                    </tbody>
            </table>
        </div>

        <div class="action-area" id="action-area" style="text-align: center; margin-top: 2rem;">
            
            <div class="iab-guide-container">
                <div class="iab-icon-circle">ğŸ”’</div>
                <div class="iab-title">PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ã«ã¯</div>
                <div class="iab-desc">
                    ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚„å°åˆ·ã‚’è¡Œã†ãŸã‚ã«ã€ä»¥ä¸‹ã®æ‰‹é †ã§å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚
                </div>
                <div class="iab-step">
                    å³ä¸Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ &nbsp;<strong>â€¢â€¢â€¢</strong>&nbsp; ã¾ãŸã¯ &nbsp;<strong>å…±æœ‰</strong>&nbsp; ã‹ã‚‰<br>
                    ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã€ã‚’é¸æŠ
                </div>
                <div class="iab-sub-note">
                    â€»æ—¢ã«Safariã‚„Chromeã§é–‹ã„ã¦ã„ã‚‹æ–¹ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œå…±æœ‰/å°åˆ·ã€ã¾ãŸã¯ã€ŒPDFã¨ã—ã¦ä¿å­˜ã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>

            <button onclick="window.location.href='index.html'" class="secondary-btn">æˆ»ã£ã¦åˆ¥ã®äº‹æ¥­æ‰€ã§ä½œæˆ</button>
        </div>
    </div>

    <script>
        const ALL_TYPES = [
            "è¨ªå•ä»‹è­·", "è¨ªå•å…¥æµ´", "è¨ªå•çœ‹è­·", "è¨ªå•ãƒªãƒãƒ“ãƒª", 
            "é€šæ‰€ä»‹è­·", "é€šæ‰€ãƒªãƒãƒ“ãƒª", "å±…å®…ä»‹è­·æ”¯æ´", "ç¦ç¥‰ç”¨å…·è²¸ä¸", 
            "å°è¦æ¨¡å¤šæ©Ÿèƒ½", "èªçŸ¥ç—‡GH", "ç‰¹å®šæ–½è¨­å…¥å±…è€…ç”Ÿæ´»", 
            "ä»‹è­·è€äººç¦ç¥‰æ–½è¨­", "ä»‹è­·è€äººä¿å¥æ–½è¨­", "ä»‹è­·åŒ»ç™‚é™¢"
        ];

        const TRAINING_DATA = [
            { name: "â‘  èªçŸ¥ç—‡ã€èªçŸ¥ç—‡ã‚±ã‚¢ã«é–¢ã™ã‚‹ç ”ä¿®", targets: "ALL" },
            { name: "â‘¡ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã«é–¢ã™ã‚‹ç ”ä¿®", targets: "ALL" },
            { name: "â‘¢ æ¥é‡ã«é–¢ã™ã‚‹ç ”ä¿®", targets: ["è¨ªå•ä»‹è­·", "è¨ªå•å…¥æµ´"] },
            { name: "â‘£ å€«ç†ãƒ»æ³•ä»¤éµå®ˆã«é–¢ã™ã‚‹ç ”ä¿®", targets: "ALL" },
            { name: "â‘¤ äº‹æ•…ã®ç™ºç”Ÿã€äºˆé˜²ã€å†ç™ºé˜²æ­¢ã«é–¢ã™ã‚‹ç ”ä¿®", targets: ALL_TYPES.filter(t => t !== "å±…å®…ä»‹è­·æ”¯æ´") },
            { name: "â‘¥ ç·Šæ€¥æ™‚ã®å¯¾å¿œã«é–¢ã™ã‚‹ç ”ä¿®", targets: ALL_TYPES.filter(t => t !== "å±…å®…ä»‹è­·æ”¯æ´") },
            { name: "â‘¦ æ„ŸæŸ“ç—‡åŠã³é£Ÿä¸­æ¯’ã®ç™ºç”ŸåŠã³è”“å»¶é˜²æ­¢ã«é–¢ã™ã‚‹ç ”ä¿®", targets: ALL_TYPES.filter(t => t !== "å±…å®…ä»‹è­·æ”¯æ´") },
            { name: "â‘§ èº«ä½“æ‹˜æŸã®æ’é™¤ã®å–ã‚Šçµ„ã¿ã«é–¢ã™ã‚‹ç ”ä¿®", targets: ALL_TYPES.filter(t => !["è¨ªå•ä»‹è­·", "è¨ªå•å…¥æµ´", "è¨ªå•ãƒªãƒãƒ“ãƒª", "å±…å®…ä»‹è­·æ”¯æ´"].includes(t)) },
            { name: "â‘¨ éå¸¸ç½å®³æ™‚ã®å¯¾å¿œã«é–¢ã™ã‚‹ç ”ä¿®", targets: "ALL" },
            { name: "â‘© ä»‹è­·äºˆé˜²åŠã³è¦ä»‹è­·ã®é€²è¡Œäºˆé˜²ã«é–¢ã™ã‚‹ç ”ä¿®", targets: ["ç‰¹å®šæ–½è¨­å…¥å±…è€…ç”Ÿæ´»"] },
            { name: "â‘ª åŒ»ç™‚ã«é–¢ã™ã‚‹ç ”ä¿®", targets: ["ä»‹è­·è€äººç¦ç¥‰æ–½è¨­"] },
            { name: "â‘« ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚±ã‚¢ï¼ˆçµ‚æœ«åŒ»ç™‚ï¼‰ã«é–¢ã™ã‚‹ç ”ä¿®", targets: ["ä»‹è­·è€äººç¦ç¥‰æ–½è¨­", "ä»‹è­·åŒ»ç™‚é™¢"] },
            { name: "â‘¬ ç²¾ç¥çš„ã‚±ã‚¢ã«é–¢ã™ã‚‹ç ”ä¿®", targets: ["èªçŸ¥ç—‡GH", "ä»‹è­·è€äººç¦ç¥‰æ–½è¨­"] },
            { name: "â‘­ æ¥­å‹™ç¶™ç¶šè¨ˆç”»ï¼ˆBCPï¼‰", targets: "ALL" },
            { name: "â‘® ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆå¯¾ç­–ãƒ»å¯¾å¿œ", targets: "ALL" },
            { name: "â‘¯ é«˜é½¢è€…è™å¾…é˜²æ­¢ã€é–¢é€£æ³•å«ã‚€è™å¾…é˜²æ­¢ã«é–¢ã™ã‚‹ç ”ä¿®", targets: "ALL" },
            { name: "â‘° çœ‹å–ã‚Šçœ‹è­·ã«é–¢ã™ã‚‹ç ”ä¿®ï¼ˆåŠ ç®—ç®—å®šæ™‚ãªã©ï¼‰", targets: ["èªçŸ¥ç—‡GH", "ç‰¹å®šæ–½è¨­å…¥å±…è€…ç”Ÿæ´»", "ä»‹è­·è€äººç¦ç¥‰æ–½è¨­"] }
        ];

        function decodeSafeBase64(encodedStr) {
            try {
                let base64 = encodedStr.replace(/-/g, '+').replace(/_/g, '/');
                while (base64.length % 4) {
                    base64 += '=';
                }
                const safeStr = atob(base64);
                return JSON.parse(decodeURIComponent(safeStr));
            } catch (e) {
                console.error("ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ:", e);
                return null;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // ä»¥ä¸‹ã€é€šå¸¸ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ­ã‚¸ãƒƒã‚¯
            let data = null;
            const urlParams = new URLSearchParams(window.location.search);
            const encodedData = urlParams.get('data');
            if (encodedData) {
                data = decodeSafeBase64(encodedData);
            }

            if (!data) {
                try {
                    const stored = localStorage.getItem('last_audit_data');
                    if (stored) {
                        data = JSON.parse(stored);
                    }
                } catch (e) {
                    console.warn("Local storage access failed", e);
                }
            }

            if (!data) {
                alert("è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…¥åŠ›ç”»é¢ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚");
                window.location.href = 'index.html'; 
                return;
            }

            renderResult(data);
        });

        function renderResult(data) {
            document.getElementById('out-facility').innerText = data.facilityName || 'æœªå…¥åŠ›';
            document.getElementById('out-rep').innerText = data.repName || 'æœªå…¥åŠ›';
            document.getElementById('out-type').innerText = data.businessType || 'æœªé¸æŠ';
            document.getElementById('out-date').innerText = data.date || new Date().toLocaleDateString('ja-JP');

            const tbody = document.getElementById('checklist-body');
            tbody.innerHTML = '';
            
            TRAINING_DATA.forEach(item => {
                let isTarget = false;
                if (item.targets === "ALL") {
                    isTarget = true;
                } else if (Array.isArray(item.targets) && item.targets.includes(data.businessType)) {
                    isTarget = true;
                }

                if (isTarget) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${item.name}</td>
                        <td></td>
                        <td class="check-col"><span class="checkbox-square"></span></td>
                    `;
                    tbody.appendChild(tr);
                }
            });
        }
    </script>
</body>
</html>